import{d as F,k as $,r as m,D as E,z as R,a as f,c as V,w as n,b as r,q as j,e as G,l as H,F as L,H as P,Z as u,M as Z,N as z,g as W,ae as J,T as K,O as Q,P as X,aG as Y,aH as ee,aI as le}from"./index-53adf29b.js";import{a as ae,u as oe}from"./index-0c2b8664.js";/* empty css              *//* empty css              */import{x as se,A as re}from"./index-9fd596c5.js";/* empty css              */import{g as ne}from"./index2-5d5b79b3.js";const be=F({__name:"UserEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(I,{emit:g}){const i=I,y=$({get(){return console.log("获取User子组件："+i.visible),i.visible},set(e){console.log("设置User子组件："+i.visible),g("update:visible",e)}}),p=m(),d=m(!1),_={userId:0,userName:"",password:"",nickname:"",phoneMobileNumber:"",phoneTeleNumber:"",emailAddress:"",roleIds:[],gender:0,birthday:"",isDisable:0},a=E({..._}),U=m({userName:[{type:"string",required:!0,message:"账号不能为空"},{asyncValidator:async(e,l)=>{if(!l)return Promise.resolve()}}],warehouseId:{type:"number",required:!0,message:"请选择仓库",validator(e,l,t,s,N){l<=0&&t(new Error("请选择仓库"))}},email:{type:"email"}}),v=m([]);m([]);async function h(){const e=await Y();if(!e||!e.isSuccess){u.msg((e==null?void 0:e.message)||"获取角色失败",{icon:2});return}v.value=e.responseData.map(l=>({label:l.roleName,value:l.roleId}))}function k(){h(),i.data?(Object.assign(a,i.data),d.value=!0,a.gender=1,i.data.roleInfos&&(a.roleIds=i.data.roleInfos.map(e=>e.roleId))):(Object.assign(a,_),d.value=!1)}function c(){var e;y.value=!1,p.value.reset(),(e=p.value)==null||e.clearValidate()}async function D(e,l){const t={userName:e.userName,password:e.password,nickname:e.nickname,phoneMobileNumber:e.phoneMobileNumber||"",phoneTeleNumber:e.phoneTeleNumber||"",emailAddress:e.emailAddress,roleIds:e.roleIds,gender:e.gender,birthday:e.birthday,status:e.isDisable};try{const s=await ee(t);if(s){if(!s.isSuccess){u.confirm(`创建用户信息失败:${s.message}`,{icon:2});return}}else{u.confirm("创建用户信息失败",{icon:2});return}u.msg(s.message||"操作成功",{icon:1}),g("done"),c()}catch(s){u.msg(s.message,{icon:2})}finally{u.close(l)}}async function q(e,l){const t={userId:e.userId,userName:e.userName,nickname:e.nickname,phoneMobileNumber:e.phoneMobileNumber||"",phoneTeleNumber:e.phoneTeleNumber||"",emailAddress:e.emailAddress,roleIds:e.roleIds,gender:e.gender,birthday:e.birthday,isDisable:e.isDisable};try{const s=await le(t);if(s){if(!s.isSuccess){u.confirm(`修改用户信息失败:${s.message}`,{icon:2});return}}else{u.confirm("修改用户信息失败",{icon:2});return}u.msg(s.message||"操作成功",{icon:1}),g("done"),c()}catch(s){u.msg(s.message,{icon:2})}finally{u.close(l)}}function x(){p.value.validate((e,l,t)=>{e&&u.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async s=>{d.value?await q(l,s):await D(l,s)}})})}return R(()=>i.visible,(e,l)=>{console.log("visible变化：",e,l),e&&k()}),(e,l)=>{const t=Z,s=z,N=W,T=J,A=se,M=re,w=ae,b=ne,C=K,O=oe,S=Q,B=X;return f(),V(B,{modelValue:y.value,"onUpdate:modelValue":l[12]||(l[12]=o=>y.value=o),area:"700px",title:d.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>x()},{text:"关闭",callback:()=>c()}],onClose:c},{default:n(()=>[r(S,{ref_key:"refForm",ref:p,model:a,rules:U.value,style:{padding:"10px"}},{default:n(()=>[r(O,null,{default:n(()=>[r(w,{md:12},{default:n(()=>[r(s,{label:"账号",prop:"userName",required:""},{default:n(()=>[r(t,{modelValue:a.userName,"onUpdate:modelValue":l[0]||(l[0]=o=>a.userName=o),placeholder:"请填写",disabled:d.value,"allow-clear":""},null,8,["modelValue","disabled"])]),_:1}),r(s,{label:"昵称",prop:"nickname",required:""},{default:n(()=>[r(t,{modelValue:a.nickname,"onUpdate:modelValue":l[1]||(l[1]=o=>a.nickname=o),placeholder:"请填写","allow-clear":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),d.value?j("",!0):(f(),V(s,{key:0,label:"密码",prop:"password",rules:[{type:"string",required:!0,message:"密码不能为空"},{type:"string",min:6,max:10,message:"密码长度6-10"}],required:""},{default:n(()=>[r(t,{modelValue:a.password,"onUpdate:modelValue":l[2]||(l[2]=o=>a.password=o),type:"password",placeholder:"请填写",password:"","allow-clear":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})),r(s,{label:"邮箱",prop:"emailAddress"},{default:n(()=>[r(t,{modelValue:a.emailAddress,"onUpdate:modelValue":l[3]||(l[3]=o=>a.emailAddress=o),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(s,{prop:"roleIds"},{label:n(()=>[G(" 角色 "),r(T,{content:"不选则解绑该用户原有的角色"},{default:n(()=>[r(N,{type:"layui-icon-about"})]),_:1})]),default:n(()=>[r(M,{modelValue:a.roleIds,"onUpdate:modelValue":l[4]||(l[4]=o=>a.roleIds=o),placeholder:"请选择",multiple:"","allow-clear":"","min-collapsed-num":1,style:{width:"100%"}},{default:n(()=>[(f(!0),H(L,null,P(v.value,o=>(f(),V(A,{key:o.value,value:o.value,label:o.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(w,{md:12},{default:n(()=>[r(s,{label:"性别",prop:"gender",required:""},{default:n(()=>[r(b,{modelValue:a.gender,"onUpdate:modelValue":l[5]||(l[5]=o=>a.gender=o),name:"gender",value:1,label:"男"},null,8,["modelValue"]),r(b,{modelValue:a.gender,"onUpdate:modelValue":l[6]||(l[6]=o=>a.gender=o),name:"gender",value:0,label:"女"},null,8,["modelValue"])]),_:1}),r(s,{label:"是否禁用",prop:"isDisable"},{default:n(()=>[r(b,{modelValue:a.isDisable,"onUpdate:modelValue":l[7]||(l[7]=o=>a.isDisable=o),name:"isDisable",value:0,label:"启用"},null,8,["modelValue"]),r(b,{modelValue:a.isDisable,"onUpdate:modelValue":l[8]||(l[8]=o=>a.isDisable=o),name:"isDisable",value:1,label:"停用"},null,8,["modelValue"])]),_:1}),r(s,{label:"手机号码",prop:"phoneMobileNumber"},{default:n(()=>[r(t,{modelValue:a.phoneMobileNumber,"onUpdate:modelValue":l[9]||(l[9]=o=>a.phoneMobileNumber=o),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(s,{label:"电话号码",prop:"phoneTeleNumber"},{default:n(()=>[r(t,{modelValue:a.phoneTeleNumber,"onUpdate:modelValue":l[10]||(l[10]=o=>a.phoneTeleNumber=o),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(s,{label:"生日",prop:"birthday"},{default:n(()=>[r(C,{modelValue:a.birthday,"onUpdate:modelValue":l[11]||(l[11]=o=>a.birthday=o),placeholder:"请选择","allow-clear":"",style:{width:"100%"},disabled:d.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}});export{be as _};
