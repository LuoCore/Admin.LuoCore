import{r as Y}from"./index-50c19f92.js";import{j as W,d as K,r as y,a5 as ee,z as R,a as g,l as Q,s as ae,f as o,k as J,a6 as le,a7 as v,c as k,w as n,b as u,a8 as ne,q as P,a9 as te,F as se,I as ue,n as E,t as B,x as q,B as oe,aa as ie,ab as re,C as ce,e as V,Z as L,ac as de,ad as me,E as pe,D as ye,g as X,J as fe,X as ve,G as ge,K as _e,a1 as be,_ as he,O as Ie,P as ke,o as Ve,Q as Z,R as F,ae as Ce,af as j,ag as xe,A as we}from"./index-ca6d4815.js";import{x as De}from"./index-9844acf0.js";import{g as Te,_ as Se}from"./index-3f3e39f8.js";/* empty css              */import{u as Me,$ as Ne}from"./useConfirm-31f08ffb.js";import{y as Ue}from"./index-29e38879.js";/* empty css              */import{V as ze}from"./index-9cf45c9e.js";const $e={class:"layui-radio-group"},Be=W(K({name:"LayRadioGroup",props:{modelValue:{type:[String,Boolean,Number]},name:null,disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(h,{emit:C}){const i=h,I=y(i.modelValue),x=y(i.disabled);return ee("radioGroup",{name:"LayRadioGroup",modelValue:I,naiveName:i.name,disabled:x}),R(()=>I,b=>{C("change",I.value),C("update:modelValue",I.value)},{deep:!0}),R(()=>i.modelValue,b=>I.value=b),R(()=>i.disabled,b=>x.value=b),(b,s)=>(g(),Q("div",$e,[ae(b.$slots,"default")]))}})),Ee=["size"],Le={class:"layui-iconpicker-main"},je={class:"layui-icon-picker-clear"},qe={class:"layui-iconpicker-suffix"},Ae={class:"layui-iconpicker-view layui-iconpicker-scroll"},Ge={key:0,class:"layui-iconpicker-search"},Fe=o("i",{class:"layui-icon layui-icon-search"},null,-1),He={class:"layui-iconpicker-list"},Qe=["onClick"],Oe={class:"layui-elip"},Re={key:1,class:"layui-iconpicker-page"},Je={id:"layui-laypage-1",class:"layui-laypage layui-laypage-default"},Ke={class:"layui-laypage-count"},Pe=[o("i",{class:"layui-icon layui-icon-left"},null,-1)],Ze={class:"layui-laypage-curr"},We=o("em",{class:"layui-laypage-em"},null,-1),Xe=o("span",{class:"layui-laypage-spr"},"…",-1),Ye=o("a",{href:"javascript:;",class:"layui-laypage-last",title:"尾页"},"14",-1),ea=[o("i",{class:"layui-icon layui-icon-right"},null,-1)],aa=W(K({name:"LayIconPicker",props:{page:{type:Boolean,default:!1},modelValue:{default:"layui-icon-face-smile"},disabled:{type:Boolean,default:!1},showSearch:{type:Boolean},allowClear:{type:Boolean},contentClass:null,contentStyle:null,size:null},emits:["update:modelValue","change"],setup(h,{emit:C}){const i=h,{size:I}=function(a){return{size:J(()=>{const e=le("LayForm",{});return a.size||e.size||"md"})}}(i),x=J(()=>i.modelValue),b=y(null),s=y(!1),T=function(){C("update:modelValue","")},A=J(()=>i.modelValue!=null&&i.modelValue!=""),f=y([]),w=y(v.length),D=y(Math.ceil(w.value/12)),m=y(1);i.page?f.value=v.slice(0,12):f.value=v;const H=()=>{const a=12*(m.value-1),e=a+12;i.page?(f.value=v.slice(a,e),w.value=v.length,D.value=Math.ceil(v.length/12)):f.value=v},M=a=>{m.value=1;const e=12*(m.value-1),r=e+12,l=a;l?i.page?(f.value=S(l,v).slice(e,r),w.value=S(l,v).length,D.value=Math.ceil(S(l,v).length/12)):f.value=S(l,v):i.page?(f.value=v.slice(e,r),w.value=v.length,D.value=Math.ceil(v.length/12)):f.value=v},S=(a,e)=>{for(var r=[],l=a.charAt(0),t=a.length,d=0;d<e.length;d++){var _=e[d],N=!1;for(var U in _)if(typeof _[U]=="function")_[U]();else{var z="";_[U]!=null&&(z=_[U]);for(var $=0;$<z.length;$++)if(z.charAt($)==l&&z.substring($).substring(0,t)==a){N=!0;break}}N&&r.push(_)}return r};return(a,e)=>(g(),k(re,{ref_key:"dropdownRef",ref:b,disabled:h.disabled,contentClass:h.contentClass,contentStyle:h.contentStyle,onHide:e[2]||(e[2]=r=>s.value=!1),onShow:e[3]||(e[3]=r=>s.value=!0),updateAtScroll:""},{content:n(()=>[o("div",Ae,[h.showSearch?(g(),Q("div",Ge,[u(ne,{onInput:M,onClear:H,autocomplete:"true","allow-clear":!0},{prefix:n(()=>[Fe]),_:1})])):P("",!0),o("div",He,[u(te,{style:{height:"200px"},thumbColor:"rgb(238, 238, 238)"},{default:n(()=>[o("ul",null,[(g(!0),Q(se,null,ue(f.value,r=>(g(),Q("li",{key:r,class:E([B(x)===r.class?"layui-this":""]),onClick:l=>function(t){var d;C("update:modelValue",t),C("change",t),(d=b.value)==null||d.hide()}(r.class)},[o("i",{class:E(["layui-icon",[r.class]])},null,2),o("p",Oe,q(r.name),1)],10,Qe))),128))])]),_:1})]),h.page?(g(),Q("div",Re,[o("div",Je,[o("span",Ke,"共 "+q(w.value)+" 个",1),o("a",{href:"javascript:;",class:E(["layui-laypage-prev",[m.value===1?"layui-disabled":""]]),onClick:e[0]||(e[0]=r=>(()=>{if(m.value===1)return;m.value=m.value-1;const l=12*(m.value-1),t=l+12;f.value=v.slice(l,t)})())},Pe,2),o("span",Ze,[We,o("em",null,q(m.value)+" / "+q(D.value),1)]),Xe,Ye,o("a",{href:"javascript:;",class:E([[m.value===D.value?"layui-disabled":""],"layui-laypage-next"]),onClick:e[1]||(e[1]=r=>(()=>{if(m.value===D.value)return;m.value=m.value+1;const l=12*(m.value-1),t=l+12;f.value=v.slice(l,t)})())},ea,2)])])):P("",!0)])]),default:n(()=>[o("div",{class:E(["layui-border-box layui-iconpicker layui-iconpicker-split",[{"layui-iconpicker-disabled":h.disabled,"has-content":B(A),"has-clear":h.allowClear}]]),size:B(I)},[o("div",Le,[o("i",{class:E(["layui-icon",[B(x)]])},null,2)]),o("span",je,[u(B(oe),{type:"layui-icon-close-fill",onClick:ie(T,["stop"])},null,8,["onClick"])]),o("span",qe,[o("i",{class:E(["layui-icon layui-icon-down",[s.value?"transform":""]])},null,2)])],10,Ee)]),_:1},8,["disabled","contentClass","contentStyle"]))}})),la=[{key:"menuId",title:"菜单Id"},{key:"menuName",title:"菜单名称",customSlot:"menuName"},{key:"menuUrl",title:"路由地址",ellipsisTooltip:!0},{key:"sortId",title:"排序",width:"80px",align:"center"},{key:"menuType",title:"类型",width:"150px",align:"center",customSlot:"menuType"},{key:"isDisable",title:"是否禁用",width:"50px",align:"center",customSlot:"isDisable"},{key:"operator",title:"操作",align:"left",customSlot:"operator",fixed:"right",width:"200px"}];const na=K({__name:"MenuEditDialogs",props:{visible:{type:Boolean,default:!1},isSub:{type:Boolean,default:!1},menuData:{}},emits:["update:visible","QueryTableData"],setup(h,{emit:C}){const i=h,I=y(),x=y([]),b={menuId:0,parentId:0,menuName:"",menuIcon:"",menuUrl:"",sortId:0,menuType:1,isDisable:!1},s=ce({...b}),T=J({get(){return i.visible},set(a){C("update:visible",a)}});function A(a){const e={id:a.menuId,title:a.menuName,field:a.parentId,children:void 0};if(a.childrenMenus&&a.childrenMenus.length>0){const r=a.childrenMenus.map(l=>A(l));e.children=r}return e}async function f(){try{const a=await be();if(a){if(!a.isSuccess||!a.responseData){L.msg(`获取菜单列表失败:${a.message}`,{icon:2});return}}else{L.msg("获取菜单列表失败",{icon:2});return}x.value=[{id:0,title:"父级",field:"",children:[]}],a.responseData.map(e=>{x.value[0].children.push(A(e))})}catch(a){L.msg(a.message,{icon:2})}}function w(a){s.parentId=Number(a)}function D(a){console.log("菜单类型，单选按钮切换事件处理:"+a),s.menuType=a}function m(){i.menuData?Object.assign(s,i.menuData):Object.assign(s,b)}R(()=>i.visible,(a,e)=>{a&&(m(),f()),console.log(a,e)});const H=y({label:{type:"string",required:!0,message:"菜单名称不能为空"},type:{type:"string",required:!0,message:"菜单类型不能为空"}});function M(){var a;I.value.reset(),(a=I.value)==null||a.clearValidate(),T.value=!1}function S(){I.value.validate((a,e,r)=>{console.log("提交："+JSON.stringify(e)),a&&L.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async l=>{debugger;var t=e.menuId>0?await de({menuId:e.menuId,parentId:e.parentId,menuName:e.menuName,menuUrl:e.menuUrl,menuIcon:e.menuIcon,menuType:e.menuType,sortId:e.sortId,isDisable:e.isDisable}):await me({parentId:e.parentId,menuName:e.menuName,menuUrl:e.menuUrl,menuIcon:e.menuIcon,menuType:e.menuType,sortId:e.sortId,isDisable:e.isDisable});t.isSuccess?(L.msg("操作成功",{icon:1}),C("QueryTableData"),M()):L.msg("操作失败！"+(t==null?void 0:t.message),{icon:2}),L.close(l)}})})}return(a,e)=>{const r=ze,l=pe,t=ye,d=X,_=fe,N=Te,U=Be,z=aa,$=Ue,G=ve,O=ge,p=_e;return g(),k(p,{modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=c=>T.value=c),area:"600px",resize:!0,size:"md",title:"菜单编辑","shade-close":!1,move:!0,maxmin:!0,btnAlign:"c",btn:[{text:"提交",callback:()=>S()},{text:"关闭",callback:()=>M()}],onClose:M},{default:n(()=>[u(O,{ref_key:"refForm",ref:I,model:s,rules:H.value,style:{padding:"10px"}},{default:n(()=>[u(l,{label:"上级菜单",prop:"parentId",required:""},{default:n(()=>[u(r,{modelValue:s.parentId,"onUpdate:modelValue":e[0]||(e[0]=c=>s.parentId=c),"allow-clear":!0,search:!0,data:x.value,disabled:a.isSub,style:{width:"100%"},onChange:e[1]||(e[1]=c=>w(c))},null,8,["modelValue","data","disabled"])]),_:1}),u(l,{label:"菜单名称",prop:"menuName",required:""},{default:n(()=>[u(t,{modelValue:s.menuName,"onUpdate:modelValue":e[2]||(e[2]=c=>s.menuName=c),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),u(l,{prop:"menuUrl"},{label:n(()=>[V(" 路由地址 "),u(_,{content:s.menuType==0?"如果类型是菜单，需要写菜单路由":"如果类型是按钮，路由地址可以不用填写"},{default:n(()=>[u(d,{type:"layui-icon-about"})]),_:1},8,["content"])]),default:n(()=>[u(t,{modelValue:s.menuUrl,"onUpdate:modelValue":e[3]||(e[3]=c=>s.menuUrl=c),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),u(l,{label:"菜单类型",prop:"menuType",required:""},{default:n(()=>[u(U,{modelValue:s.menuType,"onUpdate:modelValue":e[4]||(e[4]=c=>s.menuType=c),name:"menuType",onChange:e[5]||(e[5]=c=>D(c))},{default:n(()=>[u(N,{value:1,label:"菜单"}),u(N,{value:2,label:"按钮"})]),_:1},8,["modelValue"])]),_:1}),u(l,{label:"菜单图标",prop:"menuIcon"},{default:n(()=>[u(z,{modelValue:s.menuIcon,"onUpdate:modelValue":e[6]||(e[6]=c=>s.menuIcon=c),"allow-clear":""},null,8,["modelValue"])]),_:1}),u(l,{label:"排序",prop:"sortId"},{default:n(()=>[u($,{modelValue:s.sortId,"onUpdate:modelValue":e[7]||(e[7]=c=>s.sortId=c),position:"right",min:0},null,8,["modelValue"])]),_:1}),u(l,{prop:"isShow",class:"switch-fix"},{label:n(()=>[V(" 是否禁用 "),u(_,{content:"如果禁用，则不会出现在左侧菜单栏"},{default:n(()=>[u(d,{type:"layui-icon-about"})]),_:1})]),default:n(()=>[u(G,{modelValue:s.isDisable,"onUpdate:modelValue":e[8]||(e[8]=c=>s.isDisable=c),"onswitch-value":!0,"onswitch-text":"是","unswitch-value":!1,"unswitch-text":"否"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","btn"])}}});const ta=he(na,[["__scopeId","data-v-2d3ea3fc"]]),ya=K({__name:"index",setup(h){var r;const{loading:C,setLoading:i}=Ie(!0),x=((r=ke().meta)==null?void 0:r.title)||"",b=y([]),s=y([]),T=y(!1),A=y(["filter"]),f=y(!1),w=y(),D=y(),m=y(window.innerHeight-300);Ve(()=>{window.addEventListener("resize",H)});function H(){m.value=window.innerHeight-300}i(!1);async function M(){i(!0);try{const l=await Ce();if(!l||!l.isSuccess)return;b.value=l.responseData}catch(l){console.log(l)}finally{i(!1)}}function S(l,t){D.value=l,l?w.value={menuId:0,parentId:(t==null?void 0:t.menuId)||0,menuName:"",menuIcon:"",menuUrl:"",sortId:0,menuType:0,isDisable:!1,childrenMenus:[]}:w.value=t,f.value=!0}function a(l){if(!l){j.msg("请选择菜单",{icon:2});return}Me("确定要删除这条数据吗？",async t=>{try{j.msg("正在删除数据...",{icon:16,time:0,shade:!0,success:async d=>{var _=await xe(l);_.isSuccess?(j.msg("操作成功",{icon:1}),M()):j.msg("操作失败！"+(_==null?void 0:_.message),{icon:2}),j.close(d)}})}catch(d){j.msg(d.message,{icon:2})}j.close(t)})}function e(){T.value=!T.value}return(l,t)=>{const d=we,_=X,N=Ne,U=Se,z=De,$=Y,G=Z("any-permission"),O=Z("permission");return g(),k($,{fluid:"true",class:"z-container"},{default:n(()=>[u(z,{title:B(x)},{default:n(()=>[u(U,{id:"menuId","selected-keys":s.value,"onUpdate:selectedKeys":t[2]||(t[2]=p=>s.value=p),"children-column-name":"childrenMenus",height:`${m.value}px`,"default-expand-all":T.value,loading:B(C),columns:B(la),"data-source":b.value,"default-toolbar":A.value,"expand-index":1},{toolbar:n(()=>[F((g(),k(d,{size:"lg",type:"normal",onClick:t[0]||(t[0]=p=>M())},{default:n(()=>[V(" 查询 ")]),_:1})),[[G,["sys:user:add","sys:user:save"]]]),F((g(),k(d,{size:"lg",type:"primary",onClick:t[1]||(t[1]=p=>S(!1))},{default:n(()=>[V(" 新增 ")]),_:1})),[[G,["sys:user:add","sys:user:save"]]]),F((g(),k(d,{size:"md",type:"danger",onClick:e},{default:n(()=>[V(q(T.value?"全部收起":"全部展开"),1)]),_:1})),[[O,"sys:user:delete"]])]),operator:n(({row:p})=>[F((g(),k(d,{size:"sm",type:"primary",onClick:c=>S(!0,p)},{default:n(()=>[V(" 新增子级 ")]),_:2},1032,["onClick"])),[[G,["sys:user:add","sys:user:save"]]]),F((g(),k(d,{size:"sm",onClick:c=>S(!1,p)},{default:n(()=>[V(" 修改 ")]),_:2},1032,["onClick"])),[[G,["sys:user:edit","sys:user:update"]]]),F((g(),k(d,{size:"sm",type:"danger",onClick:c=>a(p.menuId)},{default:n(()=>[V(" 删除 ")]),_:2},1032,["onClick"])),[[O,"sys:user:delete"]])]),menuName:n(({row:p})=>[o("span",null,[p.menuIcon?(g(),k(_,{key:0,type:p.menuIcon,style:{"margin-right":"4px"}},null,8,["type"])):P("",!0),V(" "+q(p.menuName),1)])]),isDisable:n(({row:p})=>[V(q(p.isShow?"是":"否"),1)]),menuType:n(({row:p})=>[p.menuType===1?(g(),k(N,{key:0,type:"normal",bordered:""},{default:n(()=>[V(" 菜单 ")]),_:1})):(g(),k(N,{key:1,type:"warm",bordered:""},{default:n(()=>[V(" 按钮 ")]),_:1}))]),_:1},8,["selected-keys","height","default-expand-all","loading","columns","data-source","default-toolbar"])]),_:1},8,["title"]),u(ta,{visible:f.value,"onUpdate:visible":t[3]||(t[3]=p=>f.value=p),"is-sub":D.value,"menu-data":w.value,onQueryTableData:M},null,8,["visible","is-sub","menu-data"])]),_:1})}}});export{ya as default};
