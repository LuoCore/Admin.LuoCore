import{r as re}from"./index-50c19f92.js";import{j as ie,d as P,v as ue,k as Z,t as D,a as u,l as S,s as de,n as H,c as v,B as me,r as f,C as G,b as e,w as o,e as N,D as J,E as W,G as X,g as Y,A as ee,H as ce,_ as pe,z as _e,q as ye,I as ae,F as le,Z as c,J as fe,T as be,K as ge,M as ve,U as he,N as we,O as Ve,P as ke,Q as K,R as q,f as L,x as j,S as xe,V as Ne,X as De,Y as Q}from"./index-ca6d4815.js";import{x as Se}from"./index-9844acf0.js";import{g as Ue,_ as Ie}from"./index-3f3e39f8.js";/* empty css              */import{a as te,u as se}from"./index-87e6ad2e.js";import{x as oe,A as ne}from"./index-bbc62ee3.js";/* empty css              */import{u as ze,$ as Te}from"./useConfirm-31f08ffb.js";const Ce=["src","alt"],$e=ie(P({name:"LayAvatar",props:{src:null,size:{default:"md"},radius:{type:Boolean,default:!1},icon:{default:"layui-icon-username"},alt:null},setup(V){const b=V,m=ue(),h=Z(()=>["layui-avatar",b.radius?"layui-avatar-radius":"",b.size?`layui-avatar-${b.size}`:""]);return(i,_)=>D(m).default?(u(),S("span",{key:0,class:H(D(h))},[de(i.$slots,"default")],2)):(u(),S("span",{key:1,class:H(D(h))},[V.src?(u(),S("img",{key:0,src:V.src,alt:V.alt},null,8,Ce)):(u(),v(D(me),{key:1,type:V.icon},null,8,["type"]))],2))}}));const Me=[{key:"userId",title:"用户Id",width:"80px",fixed:"left",sort:"desc"},{key:"userName",title:"用户名称",width:"100px"},{key:"roleInfos",title:"角色",align:"center",width:"100px",customSlot:"roles"},{key:"nickname",title:"昵称",align:"center",width:"100px"},{key:"phoneTeleNumber",title:"电话号码",align:"center",width:"150px"},{key:"phoneMobileNumber",title:"手机号码",align:"center",width:"150px"},{key:"emailAddress",title:"电子邮箱",align:"center",width:"200px"},{key:"gender",title:"性别",align:"center",width:"90px",customSlot:"gender"},{key:"birthday",title:"生日",align:"center",width:"180px",customSlot:"birthday"},{key:"createTime",title:"创建时间",align:"center",width:"180px",customSlot:"createTime"},{key:"isDisable",title:"禁用",align:"center",width:"90px",customSlot:"isDisable"},{key:"operator",title:"操作",align:"left",customSlot:"operator",fixed:"right",width:"200px"}],qe={class:"z-search-layout"},Ae=P({__name:"UserSearchForm",emits:["onSearch"],setup(V,{expose:b,emit:m}){const h=f(),i=G({userId:0,userName:"",gender:0,isDisable:0});b({formModel:i});function _(){return m("onSearch",i)}function U(){const n=h.value.reset();return i.userId=0,i.isDisable=0,i.gender=0,n}return(n,y)=>{const k=J,w=W,g=oe,p=ne,I=X,z=te,T=Y,t=ee,s=ce,d=se;return u(),S("div",qe,[e(d,{space:"8"},{default:o(()=>[e(z,{md:15,sm:20,xs:24},{default:o(()=>[e(I,{pane:!0,size:"md",ref_key:"searchFormRef",ref:h,model:i},{default:o(()=>[e(w,{mode:"inline",label:"用户Id",prop:"userId"},{default:o(()=>[e(k,{modelValue:i.userId,"onUpdate:modelValue":y[0]||(y[0]=a=>i.userId=a),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),e(w,{mode:"inline",label:"用户名称",prop:"userName"},{default:o(()=>[e(k,{modelValue:i.userName,"onUpdate:modelValue":y[1]||(y[1]=a=>i.userName=a),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),e(w,{mode:"inline",label:"性别",prop:"gender"},{default:o(()=>[e(p,{modelValue:i.gender,"onUpdate:modelValue":y[2]||(y[2]=a=>i.gender=a),placeholder:"请选择","allow-clear":"",style:{width:"100%"}},{default:o(()=>[e(g,{value:"0",label:"不限制"}),e(g,{value:"1",label:"女"}),e(g,{value:"2",label:"男"})]),_:1},8,["modelValue"])]),_:1}),e(w,{mode:"inline",label:"是否禁用",prop:"isDisable"},{default:o(()=>[e(p,{modelValue:i.isDisable,"onUpdate:modelValue":y[3]||(y[3]=a=>i.isDisable=a),placeholder:"请选择","allow-clear":"",style:{width:"100%"}},{default:o(()=>[e(g,{value:"0",label:"不限制"}),e(g,{value:"1",label:"否"}),e(g,{value:"2",label:"是"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(z,{md:9,sm:4,xs:24,class:"z-text-center"},{default:o(()=>[e(s,{wrap:""},{default:o(()=>[e(t,{type:"primary",onClick:_},{default:o(()=>[e(T,{type:"layui-icon-search"}),N(" 查询 ")]),_:1}),e(t,{onClick:U},{default:o(()=>[e(T,{type:"layui-icon-refresh-three"}),N(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1})])}}});const Fe=pe(Ae,[["__scopeId","data-v-5c774584"]]),Pe=P({__name:"UserEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(V,{emit:b}){const m=V,h=Z({get(){return console.log("获取User子组件："+m.visible),m.visible},set(t){console.log("设置User子组件："+m.visible),b("update:visible",t)}}),i=f(),_=f(!1),U={userId:0,userName:"",password:"",nickname:"",phoneMobileNumber:"",phoneTeleNumber:"",emailAddress:"",roleIds:[],gender:0,birthday:"",isDisable:0},n=G({...U}),y=f({userName:[{type:"string",required:!0,message:"账号不能为空"},{asyncValidator:async(t,s)=>{if(!s)return Promise.resolve()}}],warehouseId:{type:"number",required:!0,message:"请选择仓库",validator(t,s,d,a,r){s<=0&&d(new Error("请选择仓库"))}},email:{type:"email"}}),k=f([]);f([]);async function w(){const t=await we();if(!t||!t.isSuccess){c.msg((t==null?void 0:t.message)||"获取角色失败",{icon:2});return}k.value=t.responseData.map(s=>({label:s.roleName,value:s.roleId}))}function g(){if(w(),m.data){Object.assign(n,m.data);debugger;_.value=!0,n.gender=1,m.data.roleInfos&&(n.roleIds=m.data.roleInfos.map(t=>t.roleId))}else Object.assign(n,U),_.value=!1}function p(){var t;h.value=!1,i.value.reset(),(t=i.value)==null||t.clearValidate()}async function I(t,s){const d={userName:t.userName,password:t.password,nickname:t.nickname,phoneMobileNumber:t.phoneMobileNumber||"",phoneTeleNumber:t.phoneTeleNumber||"",emailAddress:t.emailAddress,roleIds:t.roleIds,gender:t.gender,birthday:t.birthday,status:t.isDisable};try{const a=await ve(d);if(a){if(!a.isSuccess){c.confirm(`创建用户信息失败:${a.message}`,{icon:2});return}}else{c.confirm("创建用户信息失败",{icon:2});return}c.msg(a.message||"操作成功",{icon:1}),b("done"),p()}catch(a){c.msg(a.message,{icon:2})}finally{c.close(s)}}async function z(t,s){debugger;const d={userId:t.userId,userName:t.userName,nickname:t.nickname,phoneMobileNumber:t.phoneMobileNumber||"",phoneTeleNumber:t.phoneTeleNumber||"",emailAddress:t.emailAddress,roleIds:t.roleIds,gender:t.gender,birthday:t.birthday,isDisable:t.isDisable};try{const a=await he(d);if(a){if(!a.isSuccess){c.confirm(`修改用户信息失败:${a.message}`,{icon:2});return}}else{c.confirm("修改用户信息失败",{icon:2});return}c.msg(a.message||"操作成功",{icon:1}),b("done"),p()}catch(a){c.msg(a.message,{icon:2})}finally{c.close(s)}}function T(){i.value.validate((t,s,d)=>{debugger;if(t){debugger;c.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async a=>{_.value?await z(s,a):await I(s,a)}})}})}return _e(()=>m.visible,(t,s)=>{console.log("visible变化：",t,s),t&&g()}),(t,s)=>{const d=J,a=W,r=Y,x=fe,R=oe,B=ne,A=te,C=Ue,O=be,E=se,M=X,F=ge;return u(),v(F,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=l=>h.value=l),area:"700px",title:_.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>T()},{text:"关闭",callback:()=>p()}],onClose:p},{default:o(()=>[e(M,{ref_key:"refForm",ref:i,model:n,rules:y.value,style:{padding:"10px"}},{default:o(()=>[e(E,null,{default:o(()=>[e(A,{md:12},{default:o(()=>[e(a,{label:"账号",prop:"userName",required:""},{default:o(()=>[e(d,{modelValue:n.userName,"onUpdate:modelValue":s[0]||(s[0]=l=>n.userName=l),placeholder:"请填写",disabled:_.value,"allow-clear":""},null,8,["modelValue","disabled"])]),_:1}),e(a,{label:"昵称",prop:"nickname",required:""},{default:o(()=>[e(d,{modelValue:n.nickname,"onUpdate:modelValue":s[1]||(s[1]=l=>n.nickname=l),placeholder:"请填写","allow-clear":"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),_.value?ye("",!0):(u(),v(a,{key:0,label:"密码",prop:"password",rules:[{type:"string",required:!0,message:"密码不能为空"},{type:"string",min:6,max:10,message:"密码长度6-10"}],required:""},{default:o(()=>[e(d,{modelValue:n.password,"onUpdate:modelValue":s[2]||(s[2]=l=>n.password=l),type:"password",placeholder:"请填写",password:"","allow-clear":"",autocomplete:"off"},null,8,["modelValue"])]),_:1})),e(a,{label:"邮箱",prop:"emailAddress"},{default:o(()=>[e(d,{modelValue:n.emailAddress,"onUpdate:modelValue":s[3]||(s[3]=l=>n.emailAddress=l),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),e(a,{prop:"roleIds"},{label:o(()=>[N(" 角色 "),e(x,{content:"不选则解绑该用户原有的角色"},{default:o(()=>[e(r,{type:"layui-icon-about"})]),_:1})]),default:o(()=>[e(B,{modelValue:n.roleIds,"onUpdate:modelValue":s[4]||(s[4]=l=>n.roleIds=l),placeholder:"请选择",multiple:"","allow-clear":"","min-collapsed-num":1,style:{width:"100%"}},{default:o(()=>[(u(!0),S(le,null,ae(k.value,l=>(u(),v(R,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(A,{md:12},{default:o(()=>[e(a,{label:"性别",prop:"gender",required:""},{default:o(()=>[e(C,{modelValue:n.gender,"onUpdate:modelValue":s[5]||(s[5]=l=>n.gender=l),name:"gender",value:1,label:"男"},null,8,["modelValue"]),e(C,{modelValue:n.gender,"onUpdate:modelValue":s[6]||(s[6]=l=>n.gender=l),name:"gender",value:0,label:"女"},null,8,["modelValue"])]),_:1}),e(a,{label:"是否禁用",prop:"isDisable"},{default:o(()=>[e(C,{modelValue:n.isDisable,"onUpdate:modelValue":s[7]||(s[7]=l=>n.isDisable=l),name:"isDisable",value:0,label:"启用"},null,8,["modelValue"]),e(C,{modelValue:n.isDisable,"onUpdate:modelValue":s[8]||(s[8]=l=>n.isDisable=l),name:"isDisable",value:1,label:"停用"},null,8,["modelValue"])]),_:1}),e(a,{label:"手机号码",prop:"phoneMobileNumber"},{default:o(()=>[e(d,{modelValue:n.phoneMobileNumber,"onUpdate:modelValue":s[9]||(s[9]=l=>n.phoneMobileNumber=l),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),e(a,{label:"电话号码",prop:"phoneTeleNumber"},{default:o(()=>[e(d,{modelValue:n.phoneTeleNumber,"onUpdate:modelValue":s[10]||(s[10]=l=>n.phoneTeleNumber=l),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),e(a,{label:"生日",prop:"birthday"},{default:o(()=>[e(O,{modelValue:n.birthday,"onUpdate:modelValue":s[11]||(s[11]=l=>n.birthday=l),placeholder:"请选择","allow-clear":"",style:{width:"100%"},disabled:_.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}}),Re={style:{display:"grid"}},Be={key:0},Oe={key:1},Ee={key:2},Xe=P({__name:"index",setup(V){var d;const{loading:b,setLoading:m}=Ve(!0),i=((d=ke().meta)==null?void 0:d.title)||"",_=f(),U=f([]),n=f([]),y=f(["filter"]),k=G({current:1,limit:10,total:0,showRefresh:!0}),w=f(!1),g=f(),p={currentPageNum:1,pageSize:10};m(!1);function I(a){const r={requestData:a,pageSize:p.pageSize,currentPageNum:p.currentPageNum};z(r)}async function z(a){m(!0);try{const r=await xe(a);if(!r||!r.isSuccess)return;a&&a.currentPageNum&&(k.current=a.currentPageNum),k.total=r.pageCount,U.value=r.responseData}catch{}finally{m(!1)}}function T(a){debugger;const r=_.value.formModel;p.pageSize=a.limit,p.currentPageNum=a.current;const x={requestData:r,pageSize:p.pageSize,currentPageNum:p.currentPageNum};z(x)}function t(a){if(!a){c.msg("请选择用户",{icon:2,time:2e3});return}ze("确定要删除这条数据吗？",async()=>{debugger;try{const r=await Ne(a);if(!r||!r.isSuccess){c.confirm(r.message||"操作失败",{icon:2});return}c.msg(r.message||"操作成功",{icon:1}),I()}catch(r){c.msg(r.message,{icon:2})}finally{}})}function s(a){g.value=a,w.value=!0}return(a,r)=>{const x=ee,R=$e,B=Te,A=De,C=Ie,O=Se,E=re,M=K("any-permission"),F=K("permission");return u(),v(E,{fluid:"true",class:"z-container"},{default:o(()=>[e(O,{title:D(i)},{default:o(()=>[e(Fe,{ref_key:"searchForm",ref:_,onOnSearch:I},null,512),e(C,{id:"userId","selected-keys":n.value,"onUpdate:selectedKeys":r[1]||(r[1]=l=>n.value=l),loading:D(b),page:k,columns:D(Me),"data-source":U.value,"default-toolbar":y.value,"auto-cols-width":!0,"max-height":"450px",onChange:T},{toolbar:o(()=>[q((u(),v(x,{size:"sm",type:"primary",onClick:r[0]||(r[0]=l=>s())},{default:o(()=>[N(" 新增 ")]),_:1})),[[M,["sys:user:add","sys:user:save"]]]),q((u(),v(x,{size:"sm",type:"danger"},{default:o(()=>[N(" 删除 ")]),_:1})),[[F,"sys:user:delete"]])]),operator:o(({row:l})=>[q((u(),v(x,{size:"xs",type:"primary",onClick:$=>s(l)},{default:o(()=>[N(" 修改 ")]),_:2},1032,["onClick"])),[[M,["sys:user:edit","sys:user:update"]]]),q((u(),v(x,{size:"xs",type:"danger",onClick:$=>t(l.userId)},{default:o(()=>[N(" 删除 ")]),_:2},1032,["onClick"])),[[F,"sys:user:delete"]]),q((u(),v(x,{size:"xs"},{default:o(()=>[N(" 重置密码 ")]),_:1})),[[M,["sys:user:edit","sys:user:update"]]])]),avatar:o(({row:l})=>[e(R,{src:l.avatar,radius:""},null,8,["src"])]),roles:o(({row:l})=>[L("div",Re,[(u(!0),S(le,null,ae(l.roleInfos,$=>(u(),v(B,{key:$.roleId,"max-width":"100px",style:{margin:"2px"}},{default:o(()=>[N(j(($==null?void 0:$.roleName)||"无"),1)]),_:2},1024))),128))])]),gender:o(({row:l})=>[l.gender==1?(u(),S("span",Be,"男")):l.gender==0?(u(),S("span",Oe,"女")):(u(),S("span",Ee,"未知"))]),createTime:o(({row:l})=>[L("span",null,j(D(Q)(l.createTime,"yyyy-M-d H:m:s")),1)]),birthday:o(({row:l})=>[L("span",null,j(D(Q)(l.birthday,"yyyy-M-d H:m:s")),1)]),isDisable:o(({row:l})=>[e(A,{"model-value":l.isDisable,"onswitch-text":"是","onswitch-value":!0,"unswitch-text":"否","unswitch-value":!1},null,8,["model-value"])]),_:1},8,["selected-keys","loading","page","columns","data-source","default-toolbar"])]),_:1},8,["title"]),e(Pe,{visible:w.value,"onUpdate:visible":r[2]||(r[2]=l=>w.value=l),data:g.value,onDone:I},null,8,["visible","data"])]),_:1})}}});export{Xe as default};
