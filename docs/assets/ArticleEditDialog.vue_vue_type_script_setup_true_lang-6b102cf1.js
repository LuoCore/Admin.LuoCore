import{d as $,r as d,k as z,D as j,z as q,o as A,J as G,K as Z,a as J,c as K,w as r,b as l,f as V,t as h,Z as i,M as P,N as R,V as H,O as L,P as Q}from"./index-53adf29b.js";import{y as W}from"./index-c9fd804e.js";import{V as X}from"./index-afe1d6ba.js";import{T as Y,E as ee,F as te}from"./FileUpload-be7ce4af.js";import{_ as ae}from"./ArticleTag.vue_vue_type_script_setup_true_lang-9b0be570.js";import{E as oe,a as le}from"./Blogs-865b1ec3.js";const se={style:{display:"flex","align-items":"flex-end"}},ne={style:{border:"1px solid #ccc"}},fe=$({__name:"ArticleEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(w,{emit:_}){const c=w,x=d(),m=z({get(){return c.visible},set(e){_("update:visible",e)}}),u=d(),T=d({articleTitle:{type:"string",required:!0,message:"文章标题不能为空！"},articleContent:{type:"string",required:!0,message:"文章内容不能为空！"}}),f=d(!1),y=d([]),b={articleId:0,articleTitle:"",articleContent:"",sortId:0,tagNames:[]},o=j({...b});function v(e){const t={id:e.categoryId,title:e.categoryName,field:e.parentId,children:void 0};if(e.childrenCategorys&&e.childrenCategorys.length>0){const a=e.childrenCategorys.map(n=>v(n));t.children=a}return t}async function I(){try{const e=await le();if(e){if(!e.isSuccess||!e.responseData){i.msg(`获取分类列表失败:${e.message}`,{icon:2});return}}else{i.msg("获取分类列表失败",{icon:2});return}e.responseData.map(t=>{y.value.push(v(t))})}catch(e){i.msg(e.message,{icon:2})}}function U(){I(),c.data?(Object.assign(o,c.data),f.value=!0):(Object.assign(o,b),f.value=!1)}function p(){var e;u.value.reset(),(e=u.value)==null||e.clearValidate(),m.value=!1}function N(){u.value.validate((e,t,a)=>{e&&i.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async n=>{await B(t,n)}})})}async function B(e,t){try{const a=await oe(e);if(!a||!a.isSuccess){i.confirm((a==null?void 0:a.message)||"操作失败",{icon:2});return}i.msg((a==null?void 0:a.message)||"操作成功",{icon:1}),p(),_("done")}catch(a){i.msg(a.message,{icon:2})}finally{i.close(t)}}q(()=>c.visible,e=>{e&&U()}),A(()=>{});const k={},g=G(),C={placeholder:"请输入内容...",MENU_CONF:{}};C.MENU_CONF.uploadImage={async customUpload(e,t){const a=await te(e);!a||!a.isSuccess||t(a.responseData,"blog","文章")}},Z(()=>{const e=g.value;e!=null&&e.destroy()});const D=e=>{g.value=e};return(e,t)=>{const a=P,n=R,F=X,S=W,E=H,M=L,O=Q;return J(),K(O,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=s=>m.value=s),title:f.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>N()},{text:"关闭",callback:()=>p()}],onClose:p},{default:r(()=>[l(M,{ref_key:"refForm",ref:u,rules:T.value,model:o,pane:!0,size:"mb"},{default:r(()=>[l(n,{label:"文章标题",prop:"articleTitle"},{default:r(()=>[l(a,{modelValue:o.articleTitle,"onUpdate:modelValue":t[0]||(t[0]=s=>o.articleTitle=s)},null,8,["modelValue"])]),_:1}),l(n,{label:"分类",prop:"categoryId",mode:"inline"},{default:r(()=>[l(F,{modelValue:o.categoryId,"onUpdate:modelValue":t[1]||(t[1]=s=>o.categoryId=s),data:y.value},null,8,["modelValue","data"])]),_:1}),l(n,{label:"排序号",prop:"sortId",mode:"inline"},{default:r(()=>[l(S,{modelValue:o.sortId,"onUpdate:modelValue":t[2]||(t[2]=s=>o.sortId=s)},null,8,["modelValue"])]),_:1}),l(n,{label:"是否显示",prop:"isShow"},{default:r(()=>[V("div",se,[l(E,{modelValue:o.isShow,"onUpdate:modelValue":t[3]||(t[3]=s=>o.isShow=s),size:"lg","onswitch-text":"是","unswitch-text":"否"},null,8,["modelValue"])])]),_:1}),l(n,{label:"标签",prop:"articleTag"},{default:r(()=>[l(ae,{ref_key:"articleTag",ref:x,"tag-data":o.tagNames},null,8,["tag-data"])]),_:1}),l(n,{label:"文章内容",prop:"articleContent"},{default:r(()=>[V("div",ne,[l(h(Y),{style:{"border-bottom":"1px solid #ccc"},editor:g.value,defaultConfig:k,mode:"default"},null,8,["editor"]),l(h(ee),{style:{height:"500px","overflow-y":"hidden"},modelValue:o.articleContent,"onUpdate:modelValue":t[4]||(t[4]=s=>o.articleContent=s),defaultConfig:C,mode:"default",onOnCreated:D},null,8,["modelValue"])])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title","btn"])}}});export{fe as _};
