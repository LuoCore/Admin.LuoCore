import{j,d as _,v as V,k as L,r as g,z as b,o as A,X as P,a as w,l as v,b as N,a2 as O,w as S,s as B,t as x,n as K,i as z,H as E,f as m,a1 as M,a4 as H,c as q,Y as X,q as R,e as Y,x as G,aj as J,F as Q}from"./index-9c77520b.js";const U=["onClick"],W={class:"layui-tree-main"},Z=["onClick"],ee={key:0,class:"layui-tree-pack layui-tree-showLine",style:{display:"block"}},te=_({name:"TreeNode",props:{tree:null,nodeList:null,showCheckbox:{type:Boolean},showLine:{type:Boolean},selectedKey:null,checkStrictly:{type:[Boolean,String]},collapseTransition:{type:Boolean},onlyIconControl:{type:Boolean},tailNodeIcon:{type:[String,Boolean]}},emits:["node-click"],setup(a,{emit:t}){const e=a;function i(l){return!l.hasNextSibling&&l.parentNode&&(!l.parentNode.hasNextSibling||l.parentNode.hasNextSibling&&!l.parentNode.children)}V();const o=l=>e.showLine?l.children.length!==0?l.isLeaf?"layui-icon-subtraction":"layui-icon-addition":e.tailNodeIcon?e.tailNodeIcon:"":l.children.length>0?l.isLeaf?"layui-icon-triangle-d":"layui-icon-triangle-r":"";function r(l){t("node-click",l)}function n(l){l.isLeaf=!l.isLeaf}function u(l){e.onlyIconControl||n(l),l.isDisabled||t("node-click",l)}const y=L(()=>{function l(k){if(!e.showCheckbox)return!1;let h=0,s=!1;for(const c of k.children)c.isChecked&&h++;if(h>0&&(k.isChecked=!0),h==k.children.length){for(const c of k.children)if(s=l(c),s)break}else s=!0;return s}return k=>e.checkStrictly?!1:l(k)});return(l,k)=>{const h=z("tree-node",!0);return w(!0),v(Q,null,E(a.nodeList,(s,c)=>(w(),v("div",{key:c,class:K({"layui-tree-set":!0,"layui-tree-setLineShort":i(s),"layui-tree-setHide":s.isRoot})},[m("div",{class:K(["layui-tree-entry",{"layui-this":a.selectedKey===s.id}]),onClick:d=>function(p){e.showLine||u(p)}(s)},[m("div",W,[m("span",{class:K([a.showLine&&s.children.length>0?"layui-tree-icon":"",{"layui-tree-iconClick":!0}])},[N(x(H),{type:o(s),onClick:M(d=>n(s),["stop"])},null,8,["type","onClick"])],2),a.showCheckbox?(w(),q(X,{key:0,value:"",skin:"primary",modelValue:s.isChecked,disabled:s.isDisabled,isIndeterminate:x(y)(s),onChange:d=>function(p,C){e.tree.setCheckedKeys(p,e.checkStrictly,C)}(d,s)},null,8,["modelValue","disabled","isIndeterminate","onChange"])):R("",!0),m("span",{class:K({"layui-tree-txt":!0,"layui-disabled":s.isDisabled}),onClick:M(d=>u(s),["stop"])},[B(l.$slots,"title",{data:s},()=>[Y(G(s.title),1)])],10,Z)])],10,U),N(J,{enable:a.collapseTransition},{default:S(()=>[s.isLeaf?(w(),v("div",ee,[N(h,{tree:a.tree,"node-list":s.children,"show-checkbox":a.showCheckbox,"show-line":a.showLine,"selected-key":a.selectedKey,"collapse-transition":a.collapseTransition,checkStrictly:a.checkStrictly,"only-icon-control":a.onlyIconControl,"tail-node-icon":a.tailNodeIcon,onNodeClick:r},O({_:2},[l.$slots.title?{name:"title",fn:S(d=>[B(l.$slots,"title",{data:d.data})]),key:"0"}:void 0]),1032,["tree","node-list","show-checkbox","show-line","selected-key","collapse-transition","checkStrictly","only-icon-control","tail-node-icon"])])):R("",!0)]),_:2},1032,["enable"])],2))),128)}}});class le{constructor(t,e){this.config=t,this.treeData=[],this.init(e)}init(t){const e=this.createTree(t);this.treeData=e}createTree(t,e=""){let i;i=Array.isArray(t)?t:Array.of(Object.assign({},t));const o=[],{children:r}=this.config.replaceFields,n=i.length;for(let u=0;u<n;u++){const y=this.getNode(i[u],e,u<n-1),l=Reflect.get(y,r);Reflect.get(y,r)&&Reflect.set(y,r,this.createTree(l,y.id)),o.push(y)}return o}getNode(t,e,i){const{nodeMap:o,originMap:r,checkedKeys:n,expandKeys:u,replaceFields:{children:y,id:l,title:k}}=this.config,h=Reflect.get(t,l),s=Reflect.get(t,k),c=Reflect.get(t,y),d=!!Reflect.get(t,"disabled"),p=!!Reflect.get(t,"spread")||u.includes(h),C=o.get(e),f=Object.assign({},t,{id:h,title:s,children:c||[],parentKey:e,isRoot:e==="",isDisabled:!1,isChecked:!1,isLeaf:!1,hasNextSibling:i,parentNode:C||null});return f.isDisabled=d,f.isChecked=n.includes(h),f.isLeaf=C?C.isLeaf:u.includes(h),f.isLeaf=p,o.has(h)||o.set(h,f),r.has(h)||r.set(h,t),f}treeForeach(t,e){t.forEach(i=>{i.children&&this.treeForeach(i.children,e),e(i)})}setChildrenChecked(t,e){var i=0,o=0;const r=e.length;this.treeForeach(e,n=>{n.isDisabled||(i+=1,n.isChecked&&(o+=1))}),t=o<i;for(let n=0;n<r;n++)(!e[n].isDisabled||e[n].isDisabled&&e[n].children.length>0)&&(e[n].isChecked=t),e[n].children&&e[n].children.length>0&&this.setChildrenChecked(t,e[n].children)}setParentChecked(t,e){e&&(e.isChecked=t,e.children.some(i=>i.isChecked)&&(e.isChecked=!0),e.parentNode&&this.setParentChecked(t,e.parentNode))}setCheckedKeys(t,e,i){i.isChecked=t,e||(i.parentNode&&this.setParentChecked(t,i.parentNode),i.children&&this.setChildrenChecked(t,i.children))}getData(){return this.treeData}getKeys(){const t=[],e=[],i=this.config.nodeMap[Symbol.iterator]();let o=i.next();for(;!o.done;){const[,r]=o.value,n=Reflect.get(r,this.config.replaceFields.id);r.isChecked&&e.push(n),r.isLeaf&&t.push(n),o=i.next()}return{checkedKeys:e,expandKeys:t}}getOriginData(t){return this.config.originMap.get(t)}}const ne=_({name:"LayTree",props:{data:null,disabled:{type:Boolean,default:!1},edit:{default:!1},checkedKeys:{default:()=>[]},expandKeys:null,checkStrictly:{type:[Boolean,String],default:!1},collapseTransition:{type:Boolean,default:!0},onlyIconControl:{type:Boolean,default:!1},selectedKey:null,showLine:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1},replaceFields:{default:()=>({id:"id",children:"children",title:"title"})},tailNodeIcon:{type:[String,Boolean],default:"layui-icon-file"}},emits:["update:expandKeys","update:checkedKeys","node-click","update:selectedKey"],setup(a,{emit:t}){const e=a;V();const i=L(()=>({"layui-tree":!0,"layui-form":e.showCheckbox,"layui-tree-line":e.showLine,"layui-tree-unline":!e.showLine}));let o=g(),r=g();const n=g(!1),u=g(!1),y=()=>{let{tree:c,nodeList:d}=((p,C)=>{var f,D,T,I;const F=new le({nodeMap:new Map,originMap:new Map,replaceFields:{id:"id",title:"title",children:"children"},showCheckbox:(f=p.showCheckbox)!=null?f:!1,checkedKeys:(D=p.checkedKeys)!=null?D:[],expandKeys:(T=p.expandKeys)!=null?T:[],checkStrictly:(I=p.checkStrictly)!=null?I:!1},p.data),$=L(()=>F.getData());return{tree:F,nodeList:$}})(e);o.value=c,r.value=d.value};b(()=>e.data,()=>{n.value||y()},{deep:!0,immediate:!0}),b(()=>e.checkedKeys,()=>{n.value||y()}),b(()=>e.expandKeys,()=>{n.value||y()});const l=g(),k=g();function h(c){const d=o.value.getOriginData(c.id);t("update:selectedKey",c.id),t("node-click",d)}b(o,()=>{if(u.value){const{checkedKeys:c,expandKeys:d}=o.value.getKeys();n.value=!0,String(k.value)!=String(c)&&(k.value=c,t("update:checkedKeys",c)),String(l)!=String(d)&&(l.value=d,t("update:expandKeys",d)),setTimeout(()=>{n.value=!1},0)}},{deep:!0}),A(()=>{P(()=>{u.value=!0})});const s=g(e.selectedKey);return b(()=>e.selectedKey,()=>{s.value=e.selectedKey}),(c,d)=>(w(),v("div",{class:K(x(i))},[N(te,{tree:x(o),"node-list":x(r),"show-checkbox":a.showCheckbox,"show-line":a.showLine,selectedKey:s.value,"check-strictly":a.checkStrictly,"collapse-transition":a.collapseTransition,"only-icon-control":a.onlyIconControl,"tail-node-icon":a.tailNodeIcon,onNodeClick:h},O({_:2},[c.$slots.title?{name:"title",fn:S(({data:p})=>[B(c.$slots,"title",{data:p})]),key:"0"}:void 0]),1032,["tree","node-list","show-checkbox","show-line","selectedKey","check-strictly","collapse-transition","only-icon-control","tail-node-icon"])],2))}}),se=j(ne);export{ne as M,se as _};
