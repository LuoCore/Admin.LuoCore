import{d as C,k as D,r as i,D as N,z as S,a as T,c as U,w as m,b as r,Z as s,M as F,N as O,O as j,P as q,ab as z,az as E}from"./index-a5a9e71e.js";import{V as G}from"./index-7524af9d.js";const P=C({__name:"RoleEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(b,{emit:y}){const u=b,d=D({get(){return u.visible},set(e){y("update:visible",e)}}),_=i([]),c=i(),f=i(!1),v={roleName:"",roleId:0,menuIds:[]},l=N({...v}),h=i({name:{type:"string",required:!0,message:"角色名不能为空"},code:{type:"string",required:!0,message:"角色编码不能为空"}});async function V(){try{const e=await z();if(e){if(!e.isSuccess||!e.responseData){s.msg(`获取菜单列表失败:${e.message}`,{icon:2});return}}else{s.msg("获取菜单列表失败",{icon:2});return}e.responseData.map(a=>{_.value.push(g(a))})}catch(e){s.msg(e.message,{icon:2})}}function g(e){const a={id:e.menuId,title:e.menuName,field:e.parentId,children:void 0};if(e.childrenMenus&&e.childrenMenus.length>0){const t=e.childrenMenus.map(n=>g(n));a.children=t}return a}function x(){V(),u.data?(Object.assign(l,u.data),f.value=!0):(Object.assign(l,v),f.value=!1)}function p(){var e;c.value.reset(),(e=c.value)==null||e.clearValidate(),d.value=!1}async function w(e,a){try{const t=await E(e);if(!t||!t.isSuccess){s.confirm((t==null?void 0:t.message)||"操作失败",{icon:2});return}s.msg((t==null?void 0:t.message)||"操作成功",{icon:1}),p()}catch(t){s.msg(t.message,{icon:2})}finally{s.close(a)}}function M(){c.value.validate((e,a,t)=>{e&&s.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async n=>{await w(a,n)}})})}return S(()=>u.visible,e=>{e&&x()}),(e,a)=>{const t=F,n=O,k=G,I=j,B=q;return T(),U(B,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=o=>d.value=o),area:"500px",title:f.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>M()},{text:"关闭",callback:()=>p()}],onClose:p},{default:m(()=>[r(I,{ref_key:"refForm",ref:c,model:l,rules:h.value,style:{padding:"10px"}},{default:m(()=>[r(n,{label:"角色名",prop:"account"},{default:m(()=>[r(t,{modelValue:l.roleName,"onUpdate:modelValue":a[0]||(a[0]=o=>l.roleName=o),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(n,{label:"菜单信息",prop:"describe"},{default:m(()=>[r(k,{modelValue:l.menuIds,"onUpdate:modelValue":a[1]||(a[1]=o=>l.menuIds=o),data:_.value,placeholder:"请选择","allow-clear":!0,search:!0,multiple:!0,checkStrictly:!1},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}});export{P as _};
