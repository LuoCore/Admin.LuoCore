import{r as Y}from"./index-50c19f92.js";import{d as z,r as d,a as M,l as ee,b as r,w as a,D as G,E as q,G as L,_ as te,k as O,C as j,z as Z,c as C,Z as s,K as A,a0 as oe,a1 as Q,o as se,a2 as ae,O as le,P as ne,Q as P,t as T,R as F,e as U,a3 as re,A as ue,a4 as ce}from"./index-ca6d4815.js";import{x as ie}from"./index-9844acf0.js";import{_ as de}from"./index-3f3e39f8.js";import{a as me,u as fe}from"./index-87e6ad2e.js";import{u as pe}from"./useConfirm-31f08ffb.js";import{V as _e,_ as ve}from"./index-9cf45c9e.js";const ye=[{title:"",type:"checkbox",width:"50px",fixed:"left"},{key:"roleId",title:"角色Id",align:"center"},{key:"roleName",title:"角色名",align:"center"},{key:"operator",title:"操作",align:"center",width:"180px",customSlot:"operator",fixed:"right"}],ge={class:"z-search-layout"},he=z({__name:"RoleSearchForm",props:{formModel:{}},setup(S,{expose:V}){const l=S,h=d();V({resetForm:_});function _(){debugger;return h.value.reset()}return(y,v)=>{const b=G,m=q,k=me,o=fe,e=L;return M(),ee("div",ge,[r(e,{ref_key:"searchFormRef",ref:h,model:l.formModel},{default:a(()=>[r(o,null,{default:a(()=>[r(k,{md:8,sm:12,xs:24},{default:a(()=>[r(m,{label:"角色Id",prop:"roleId"},{default:a(()=>[r(b,{modelValue:l.formModel.roleId,"onUpdate:modelValue":v[0]||(v[0]=p=>l.formModel.roleId=p),placeholder:"请填写","allow-clear":"",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),r(k,{md:8,sm:12,xs:24},{default:a(()=>[r(m,{label:"角色名称",prop:"roleName"},{default:a(()=>[r(b,{modelValue:l.formModel.roleName,"onUpdate:modelValue":v[1]||(v[1]=p=>l.formModel.roleName=p),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])}}});const be=te(he,[["__scopeId","data-v-325d5f8d"]]),ke=z({__name:"RoleEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(S,{emit:V}){const l=S,h=O({get(){return l.visible},set(t){V("update:visible",t)}}),_=d([]),y=d(),v=d(!1),b={roleName:"",roleId:0,menuIds:[]},m=j({...b}),k=d({name:{type:"string",required:!0,message:"角色名不能为空"},code:{type:"string",required:!0,message:"角色编码不能为空"}});async function o(){try{const t=await Q();if(t){if(!t.isSuccess||!t.responseData){s.msg(`获取菜单列表失败:${t.message}`,{icon:2});return}}else{s.msg("获取菜单列表失败",{icon:2});return}t.responseData.map(u=>{_.value.push(e(u))})}catch(t){s.msg(t.message,{icon:2})}}function e(t){const u={id:t.menuId,title:t.menuName,field:t.parentId,children:void 0};if(t.childrenMenus&&t.childrenMenus.length>0){const c=t.childrenMenus.map(I=>e(I));u.children=c}return u}function p(){o(),l.data?(Object.assign(m,l.data),v.value=!0):(Object.assign(m,b),v.value=!1)}function x(){var t;y.value.reset(),(t=y.value)==null||t.clearValidate(),h.value=!1}async function w(t,u){try{const c=await oe(t);if(!c||!c.isSuccess){s.confirm((c==null?void 0:c.message)||"操作失败",{icon:2});return}s.msg((c==null?void 0:c.message)||"操作成功",{icon:1}),x()}catch(c){s.msg(c.message,{icon:2})}finally{s.close(u)}}function N(){y.value.validate((t,u,c)=>{t&&s.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async I=>{await w(u,I)}})})}return Z(()=>l.visible,t=>{t&&p()}),(t,u)=>{const c=G,I=q,$=_e,B=L,E=A;return M(),C(E,{modelValue:h.value,"onUpdate:modelValue":u[2]||(u[2]=D=>h.value=D),area:"500px",title:v.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>N()},{text:"关闭",callback:()=>x()}],onClose:x},{default:a(()=>[r(B,{ref_key:"refForm",ref:y,model:m,rules:k.value,style:{padding:"10px"}},{default:a(()=>[r(I,{label:"角色名",prop:"account"},{default:a(()=>[r(c,{modelValue:m.roleName,"onUpdate:modelValue":u[0]||(u[0]=D=>m.roleName=D),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(I,{label:"菜单信息",prop:"describe"},{default:a(()=>[r($,{modelValue:m.menuIds,"onUpdate:modelValue":u[1]||(u[1]=D=>m.menuIds=D),data:_.value,placeholder:"请选择","allow-clear":!0,search:!0,multiple:!0,checkStrictly:!1},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}});const xe=z({__name:"RoleMenuEdit",props:{visible:{type:Boolean},roleId:{},checkedMenuIds:{}},emits:["done","update:visible"],setup(S,{emit:V}){const l=S,h=O({get(){return l.visible},set(o){V("update:visible",o)}});debugger;const _=d([]),y=d([]);async function v(){_.value=l.checkedMenuIds,s.msg("正在获取菜单信息...",{icon:16,time:0,shade:!0,success:async o=>{debugger;try{const e=await Q();if(e){if(!e.isSuccess||!e.responseData){s.msg(`获取菜单列表失败:${e.message}`,{icon:2});return}}else{s.msg("获取菜单列表失败",{icon:2});return}e.responseData.map(p=>{y.value.push(b(p))})}catch(e){s.msg(e.message,{icon:2})}finally{s.close(o)}}})}function b(o){const e={id:o.menuId,title:o.menuName,field:o.iconUrl,spread:!0,children:void 0};if(o.childrenMenus&&o.childrenMenus.length>0){const p=o.childrenMenus.map(x=>b(x));e.children=p}return e}function m(){_.value=[],y.value=[],h.value=!1}async function k(){s.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async o=>{try{const e=await ae({roleId:l.roleId,menuIds:_.value});if(!e||!e.isSuccess){s.msg((e==null?void 0:e.message)||"操作失败",{icon:2});return}s.msg((e==null?void 0:e.message)||"操作成功",{icon:1}),m(),V("done")}catch(e){s.msg(e.message,{icon:2})}finally{s.close(o)}}})}return Z(()=>l.visible,o=>{o&&v()}),se(()=>{_.value=l.checkedMenuIds}),(o,e)=>{const p=ve,x=A;return M(),C(x,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=w=>h.value=w),area:["300px","700px"],title:"分配权限","shade-close":!1,move:!0,maxmin:!1,btn:[{text:"提交",callback:()=>k()},{text:"关闭",callback:()=>m()}],onClose:m},{default:a(()=>[r(p,{checkedKeys:_.value,"onUpdate:checkedKeys":e[0]||(e[0]=w=>_.value=w),data:y.value,"show-checkbox":!0,"show-line":!1},null,8,["checkedKeys","data"])]),_:1},8,["modelValue","btn"])}}}),Se=z({name:"system_role",__name:"index",setup(S){var D;const{loading:V,setLoading:l}=le(!0),_=((D=ne().meta)==null?void 0:D.title)||"",y=d(),v=d([]),b=d([]),m=d(["filter"]),k=d({total:0,limit:10,current:1,showRefresh:!0}),o=d(!1),e=d(!1),p=d(),x=d(0),w=d([]),N=j({currentPageNum:1,pageSize:10,requestData:{}});l(!1);const t=()=>{y.value.resetForm()};async function u(f){l(!0);try{const n=await ce(f);if(!n||!n.responseData)return;f&&f.currentPageNum&&(k.value.current=f.currentPageNum),k.value.total=Number(n.pageCount),v.value=n.responseData}catch{}finally{l(!1)}}function c(f){N.currentPageNum=f.current,N.pageSize=f.limit,u(N)}function I(){u(N)}function $(f){debugger;p.value=f,o.value=!0}function B(f){debugger;x.value=f.roleId,w.value=f.menuIds,e.value=!0}function E(f){if(!f){s.msg("请选择角色",{icon:2});return}pe("确定要删除这条数据吗？",async n=>{try{const i=await re(f.roleId);if(!i||!i.isSuccess){s.msg((i==null?void 0:i.message)||"操作失败",{icon:2});return}s.msg((i==null?void 0:i.message)||"操作成功",{icon:1}),I(),s.close(n)}catch(i){s.msg(i.message,{icon:2})}})}return(f,n)=>{const i=ue,H=de,J=ie,W=Y,R=P("any-permission"),X=P("permission");return M(),C(W,{fluid:"true",class:"z-container"},{default:a(()=>[r(J,{title:T(_)},{default:a(()=>[r(be,{ref_key:"searchForm",ref:y,"form-model":N.requestData},null,8,["form-model"]),r(H,{id:"id","selected-keys":b.value,"onUpdate:selectedKeys":n[3]||(n[3]=g=>b.value=g),loading:T(V),page:k.value,columns:T(ye),"data-source":v.value,"default-toolbar":m.value,"max-height":"450px",onChange:c},{toolbar:a(()=>[F((M(),C(i,{size:"md",type:"normal",onClick:n[0]||(n[0]=g=>I())},{default:a(()=>[U(" 查询 ")]),_:1})),[[R,["sys:role:add","sys:role:save"]]]),F((M(),C(i,{size:"md",onClick:n[1]||(n[1]=g=>t()),border:"blue"},{default:a(()=>[U(" 重置 ")]),_:1})),[[R,["sys:role:add","sys:role:save"]]]),F((M(),C(i,{size:"sm",type:"primary",onClick:n[2]||(n[2]=g=>$())},{default:a(()=>[U(" 新增 ")]),_:1})),[[R,["sys:role:add","sys:role:save"]]])]),operator:a(({row:g})=>[F((M(),C(i,{size:"xs",type:"primary",onClick:K=>$(g)},{default:a(()=>[U(" 修改 ")]),_:2},1032,["onClick"])),[[R,["sys:role:edit","sys:role:update"]]]),F((M(),C(i,{size:"xs",type:"danger",onClick:K=>E(g)},{default:a(()=>[U(" 删除 ")]),_:2},1032,["onClick"])),[[X,"sys:role:delete"]]),F((M(),C(i,{size:"xs",type:"normal",onClick:K=>B(g)},{default:a(()=>[U(" 分配权限 ")]),_:2},1032,["onClick"])),[[R,["sys:role:edit","sys:role:update"]]])]),_:1},8,["selected-keys","loading","page","columns","data-source","default-toolbar"])]),_:1},8,["title"]),r(ke,{visible:o.value,"onUpdate:visible":n[4]||(n[4]=g=>o.value=g),data:p.value},null,8,["visible","data"]),r(xe,{visible:e.value,"onUpdate:visible":n[5]||(n[5]=g=>e.value=g),"role-id":x.value,"checked-menu-ids":w.value,onDone:I},null,8,["visible","role-id","checked-menu-ids"])]),_:1})}}});export{Se as default};
