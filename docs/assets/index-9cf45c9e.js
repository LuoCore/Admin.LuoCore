import{j as q,d as j,v as G,k as K,r as C,z as x,o as X,aw as Y,a as S,l as R,b as N,ar as J,w as B,s as $,t as v,n as L,i as Z,I as ee,f as D,aa as U,B as O,c as A,ao as le,q as H,e as te,x as ae,ay as ne,F as se,a6 as ie,az as _,an as P,a8 as oe,ab as ce}from"./index-ca6d4815.js";import{M as de}from"./useConfirm-31f08ffb.js";const re=["onClick"],ue={class:"layui-tree-main"},he=["onClick"],pe={key:0,class:"layui-tree-pack layui-tree-showLine",style:{display:"block"}},ye=j({name:"TreeNode",props:{tree:null,nodeList:null,showCheckbox:{type:Boolean},showLine:{type:Boolean},selectedKey:null,checkStrictly:{type:[Boolean,String]},collapseTransition:{type:Boolean},onlyIconControl:{type:Boolean},tailNodeIcon:{type:[String,Boolean]}},emits:["node-click"],setup(t,{emit:l}){const e=t;function c(a){return!a.hasNextSibling&&a.parentNode&&(!a.parentNode.hasNextSibling||a.parentNode.hasNextSibling&&!a.parentNode.children)}G();const r=a=>e.showLine?a.children.length!==0?a.isLeaf?"layui-icon-subtraction":"layui-icon-addition":e.tailNodeIcon?e.tailNodeIcon:"":a.children.length>0?a.isLeaf?"layui-icon-triangle-d":"layui-icon-triangle-r":"";function u(a){l("node-click",a)}function s(a){a.isLeaf=!a.isLeaf}function k(a){e.onlyIconControl||s(a),a.isDisabled||l("node-click",a)}const f=K(()=>{function a(m){if(!e.showCheckbox)return!1;let d=0,i=!1;for(const h of m.children)h.isChecked&&d++;if(d>0&&(m.isChecked=!0),d==m.children.length){for(const h of m.children)if(i=a(h),i)break}else i=!0;return i}return m=>e.checkStrictly?!1:a(m)});return(a,m)=>{const d=Z("tree-node",!0);return S(!0),R(se,null,ee(t.nodeList,(i,h)=>(S(),R("div",{key:h,class:L({"layui-tree-set":!0,"layui-tree-setLineShort":c(i),"layui-tree-setHide":i.isRoot})},[D("div",{class:L(["layui-tree-entry",{"layui-this":t.selectedKey===i.id}]),onClick:y=>function(g){e.showLine||k(g)}(i)},[D("div",ue,[D("span",{class:L([t.showLine&&i.children.length>0?"layui-tree-icon":"",{"layui-tree-iconClick":!0}])},[N(v(O),{type:r(i),onClick:U(y=>s(i),["stop"])},null,8,["type","onClick"])],2),t.showCheckbox?(S(),A(le,{key:0,value:"",skin:"primary",modelValue:i.isChecked,disabled:i.isDisabled,isIndeterminate:v(f)(i),onChange:y=>function(g,w){e.tree.setCheckedKeys(g,e.checkStrictly,w)}(y,i)},null,8,["modelValue","disabled","isIndeterminate","onChange"])):H("",!0),D("span",{class:L({"layui-tree-txt":!0,"layui-disabled":i.isDisabled}),onClick:U(y=>k(i),["stop"])},[$(a.$slots,"title",{data:i},()=>[te(ae(i.title),1)])],10,he)])],10,re),N(ne,{enable:t.collapseTransition},{default:B(()=>[i.isLeaf?(S(),R("div",pe,[N(d,{tree:t.tree,"node-list":i.children,"show-checkbox":t.showCheckbox,"show-line":t.showLine,"selected-key":t.selectedKey,"collapse-transition":t.collapseTransition,checkStrictly:t.checkStrictly,"only-icon-control":t.onlyIconControl,"tail-node-icon":t.tailNodeIcon,onNodeClick:u},J({_:2},[a.$slots.title?{name:"title",fn:B(y=>[$(a.$slots,"title",{data:y.data})]),key:"0"}:void 0]),1032,["tree","node-list","show-checkbox","show-line","selected-key","collapse-transition","checkStrictly","only-icon-control","tail-node-icon"])])):H("",!0)]),_:2},1032,["enable"])],2))),128)}}});class fe{constructor(l,e){this.config=l,this.treeData=[],this.init(e)}init(l){const e=this.createTree(l);this.treeData=e}createTree(l,e=""){let c;c=Array.isArray(l)?l:Array.of(Object.assign({},l));const r=[],{children:u}=this.config.replaceFields,s=c.length;for(let k=0;k<s;k++){const f=this.getNode(c[k],e,k<s-1),a=Reflect.get(f,u);Reflect.get(f,u)&&Reflect.set(f,u,this.createTree(a,f.id)),r.push(f)}return r}getNode(l,e,c){const{nodeMap:r,originMap:u,checkedKeys:s,expandKeys:k,replaceFields:{children:f,id:a,title:m}}=this.config,d=Reflect.get(l,a),i=Reflect.get(l,m),h=Reflect.get(l,f),y=!!Reflect.get(l,"disabled"),g=!!Reflect.get(l,"spread")||k.includes(d),w=r.get(e),b=Object.assign({},l,{id:d,title:i,children:h||[],parentKey:e,isRoot:e==="",isDisabled:!1,isChecked:!1,isLeaf:!1,hasNextSibling:c,parentNode:w||null});return b.isDisabled=y,b.isChecked=s.includes(d),b.isLeaf=w?w.isLeaf:k.includes(d),b.isLeaf=g,r.has(d)||r.set(d,b),u.has(d)||u.set(d,l),b}treeForeach(l,e){l.forEach(c=>{c.children&&this.treeForeach(c.children,e),e(c)})}setChildrenChecked(l,e){var c=0,r=0;const u=e.length;this.treeForeach(e,s=>{s.isDisabled||(c+=1,s.isChecked&&(r+=1))}),l=r<c;for(let s=0;s<u;s++)(!e[s].isDisabled||e[s].isDisabled&&e[s].children.length>0)&&(e[s].isChecked=l),e[s].children&&e[s].children.length>0&&this.setChildrenChecked(l,e[s].children)}setParentChecked(l,e){e&&(e.isChecked=l,e.children.some(c=>c.isChecked)&&(e.isChecked=!0),e.parentNode&&this.setParentChecked(l,e.parentNode))}setCheckedKeys(l,e,c){c.isChecked=l,e||(c.parentNode&&this.setParentChecked(l,c.parentNode),c.children&&this.setChildrenChecked(l,c.children))}getData(){return this.treeData}getKeys(){const l=[],e=[],c=this.config.nodeMap[Symbol.iterator]();let r=c.next();for(;!r.done;){const[,u]=r.value,s=Reflect.get(u,this.config.replaceFields.id);u.isChecked&&e.push(s),u.isLeaf&&l.push(s),r=c.next()}return{checkedKeys:e,expandKeys:l}}getOriginData(l){return this.config.originMap.get(l)}}const Q=j({name:"LayTree",props:{data:null,disabled:{type:Boolean,default:!1},edit:{default:!1},checkedKeys:{default:()=>[]},expandKeys:null,checkStrictly:{type:[Boolean,String],default:!1},collapseTransition:{type:Boolean,default:!0},onlyIconControl:{type:Boolean,default:!1},selectedKey:null,showLine:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1},replaceFields:{default:()=>({id:"id",children:"children",title:"title"})},tailNodeIcon:{type:[String,Boolean],default:"layui-icon-file"}},emits:["update:expandKeys","update:checkedKeys","node-click","update:selectedKey"],setup(t,{emit:l}){const e=t;G();const c=K(()=>({"layui-tree":!0,"layui-form":e.showCheckbox,"layui-tree-line":e.showLine,"layui-tree-unline":!e.showLine}));let r=C(),u=C();const s=C(!1),k=C(!1),f=()=>{let{tree:h,nodeList:y}=((g,w)=>{var b,T,V,z;const F=new fe({nodeMap:new Map,originMap:new Map,replaceFields:{id:"id",title:"title",children:"children"},showCheckbox:(b=g.showCheckbox)!=null?b:!1,checkedKeys:(T=g.checkedKeys)!=null?T:[],expandKeys:(V=g.expandKeys)!=null?V:[],checkStrictly:(z=g.checkStrictly)!=null?z:!1},g.data),M=K(()=>F.getData());return{tree:F,nodeList:M}})(e);r.value=h,u.value=y.value};x(()=>e.data,()=>{s.value||f()},{deep:!0,immediate:!0}),x(()=>e.checkedKeys,()=>{s.value||f()}),x(()=>e.expandKeys,()=>{s.value||f()});const a=C(),m=C();function d(h){const y=r.value.getOriginData(h.id);l("update:selectedKey",h.id),l("node-click",y)}x(r,()=>{if(k.value){const{checkedKeys:h,expandKeys:y}=r.value.getKeys();s.value=!0,String(m.value)!=String(h)&&(m.value=h,l("update:checkedKeys",h)),String(a)!=String(y)&&(a.value=y,l("update:expandKeys",y)),setTimeout(()=>{s.value=!1},0)}},{deep:!0}),X(()=>{Y(()=>{k.value=!0})});const i=C(e.selectedKey);return x(()=>e.selectedKey,()=>{i.value=e.selectedKey}),(h,y)=>(S(),R("div",{class:L(v(c))},[N(ye,{tree:v(r),"node-list":v(u),"show-checkbox":t.showCheckbox,"show-line":t.showLine,selectedKey:i.value,"check-strictly":t.checkStrictly,"collapse-transition":t.collapseTransition,"only-icon-control":t.onlyIconControl,"tail-node-icon":t.tailNodeIcon,onNodeClick:d},J({_:2},[h.$slots.title?{name:"title",fn:B(({data:g})=>[$(h.$slots,"title",{data:g})]),key:"0"}:void 0]),1032,["tree","node-list","show-checkbox","show-line","selectedKey","check-strictly","collapse-transition","only-icon-control","tail-node-icon"])],2))}}),ve=q(Q),ke={class:"layui-tree-select-content"},Ce=q(j({name:"LayTreeSelect",props:{data:null,modelValue:null,disabled:{type:Boolean,default:!1},placeholder:null,multiple:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},collapseTagsTooltip:{type:Boolean,default:!0},minCollapsedNum:{default:3},size:null,checkStrictly:{type:Boolean,default:!0},search:{type:Boolean,default:!1},contentClass:null,contentStyle:null},emits:["update:modelValue","change","search"],setup(t,{emit:l}){const e=t,{size:c}=function(o){return{size:K(()=>{const n=ie("LayForm",{});return o.size||n.size||"md"})}}(e),r=C(),u=C(),s=C(),k=C([]),f=C(!1),a=C(),m=C(!1),d=K({get:()=>e.multiple&&e.modelValue==null?[]:e.modelValue,set(o){l("update:modelValue",o),l("change",o)}}),i=K({get:()=>e.multiple?e.modelValue:[],set(o){e.multiple&&(l("update:modelValue",o),l("change",o))}});x([d,r],()=>{if(e.multiple)try{k.value=d.value.map(o=>{var n=_(e.data,o);return n&&(n.label=n.title,n.value=n.id,n.closable=!n.disabled),n==null&&(n={label:o,value:o,closable:!0}),n})}catch{throw new Error("v-model / model-value is not an array type")}else{const o=_(e.data,d.value);s.value=o?o.title:""}},{immediate:!0,deep:!0});const h=function(){e.multiple?l("update:modelValue",[]):l("update:modelValue","")},y=o=>{e.multiple||(a.value.hide(),d.value=o.id)},g=o=>{if(a.value.hide(),e.checkStrictly)l("update:modelValue",i.value.filter(n=>n!=o));else{const n=_(e.data,o),p=w(n);l("update:modelValue",i.value.filter(I=>!p.includes(I)))}},w=o=>{const n=[];return function p(I,E){E.push(I.id),I.children&&I.children.forEach(W=>{p(W,E)})}(o,n),n},b=K(()=>Array.isArray(d)?d.value.length>0:d.value!=""&&d.value!=null&&d.value!=null),T=K(()=>b.value?"":e.placeholder),V=o=>{m.value||(l("search",o),u.value=o)},z=()=>{m.value=!0},F=o=>{m.value=!1,V(o.target.value)};function M(o,n){return o.map(p=>({...p})).filter(p=>(p.children=p.children&&M(p.children,n),n(p)||p.children&&p.children.length))}return x(u,()=>{u.value===""?r.value=e.data:r.value=M(e.data,o=>o.title.indexOf(u.value)>-1)}),x(()=>e.data,()=>{r.value=e.data},{immediate:!0,deep:!0}),(o,n)=>(S(),R("div",{class:L(["layui-tree-select",{"layui-disabled":t.disabled,"has-content":v(b),"has-clear":t.allowClear}])},[N(ce,{ref_key:"dropdownRef",ref:a,disabled:t.disabled,contentClass:t.contentClass,contentStyle:t.contentStyle,"update-at-scroll":!0,onShow:n[4]||(n[4]=p=>f.value=!0),onHide:n[5]||(n[5]=p=>f.value=!1)},{content:B(()=>[D("div",ke,[N(Q,{data:r.value,onlyIconControl:!0,"show-checkbox":t.multiple,"check-strictly":t.checkStrictly,selectedKey:v(d),"onUpdate:selectedKey":n[2]||(n[2]=p=>P(d)?d.value=p:null),checkedKeys:v(i),"onUpdate:checkedKeys":n[3]||(n[3]=p=>P(i)?i.value=p:null),onNodeClick:y},null,8,["data","show-checkbox","check-strictly","selectedKey","checkedKeys"])])]),default:B(()=>[t.multiple?(S(),A(de,{key:0,size:v(c),"allow-clear":t.allowClear,placeholder:v(T),collapseTagsTooltip:t.collapseTagsTooltip,minCollapsedNum:t.minCollapsedNum,disabledInput:!t.search,onInputValueChange:V,onRemove:g,onClear:h,modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=p=>k.value=p)},{suffix:B(()=>[N(v(O),{type:"layui-icon-triangle-d",class:L({triangle:f.value})},null,8,["class"])]),_:1},8,["size","allow-clear","placeholder","collapseTagsTooltip","minCollapsedNum","disabledInput","modelValue"])):(S(),A(oe,{key:1,modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=p=>s.value=p),"allow-clear":t.allowClear,placeholder:v(T),disabled:t.disabled,readonly:!t.search,size:v(c),onClear:h,onInput:V,onCompositionstart:z,onCompositionend:F},{suffix:B(()=>[N(v(O),{type:"layui-icon-triangle-d",class:L({triangle:f.value})},null,8,["class"])]),_:1},8,["modelValue","allow-clear","placeholder","disabled","readonly","size"]))]),_:1},8,["disabled","contentClass","contentStyle"])],2))}}));export{Ce as V,ve as _};
