import{d as B,k as C,r as m,D as N,z as S,a as T,c as U,w as d,b as r,Z as s,I as F,J as j,K as q,M as E}from"./index-fe4b4c07.js";import{V as G}from"./index-b55d2b3a.js";import{c as O,g as Z}from"./Basic-fb711c43.js";const K=B({__name:"RoleEditDialog",props:{visible:{type:Boolean},formData:{}},emits:["done","update:visible"],setup(y,{emit:v}){const u=y,f=C({get(){return u.visible},set(e){v("update:visible",e)}}),c=m([]),i=m(),p=m(!1),g={roleName:"",roleId:0,menuIds:[]},o=N({...g}),h=m({name:{type:"string",required:!0,message:"角色名不能为空"},code:{type:"string",required:!0,message:"角色编码不能为空"}});function V(){x(),u.formData?(Object.assign(o,u.formData),p.value=!0):(Object.assign(o,g),p.value=!1)}S(()=>u.visible,e=>{e&&V()});async function x(){try{const e=await O();if(e){if(!e.isSuccess||!e.responseData){s.msg(`获取菜单列表失败:${e.message}`,{icon:2});return}}else{s.msg("获取菜单列表失败",{icon:2});return}c.value=[],e.responseData.map(a=>{c.value.push(b(a))})}catch(e){s.msg(e.message,{icon:2})}}function b(e){const a={id:e.menuId,title:e.menuName,field:e.parentId,children:void 0};if(e.childrenMenus&&e.childrenMenus.length>0){const t=e.childrenMenus.map(l=>b(l));a.children=t}return a}function _(){var e;i.value.reset(),(e=i.value)==null||e.clearValidate(),c.value=[],f.value=!1}async function D(e,a){try{const t=await Z(e);if(!t||!t.isSuccess){s.confirm((t==null?void 0:t.message)||"操作失败",{icon:2});return}s.msg((t==null?void 0:t.message)||"操作成功",{icon:1}),v("done"),_()}catch(t){s.msg(t.message,{icon:2})}finally{s.close(a)}}function w(){i.value.validate((e,a,t)=>{e&&s.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async l=>{await D(a,l)}})})}return(e,a)=>{const t=F,l=j,I=G,M=q,k=E;return T(),U(k,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=n=>f.value=n),area:"500px",title:p.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>w()},{text:"关闭",callback:()=>_()}],onClose:_},{default:d(()=>[r(M,{ref_key:"refForm",ref:i,model:o,rules:h.value,style:{padding:"10px"}},{default:d(()=>[r(l,{label:"角色名",prop:"account"},{default:d(()=>[r(t,{modelValue:o.roleName,"onUpdate:modelValue":a[0]||(a[0]=n=>o.roleName=n),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),r(l,{label:"菜单信息",prop:"describe"},{default:d(()=>[r(I,{modelValue:o.menuIds,"onUpdate:modelValue":a[1]||(a[1]=n=>o.menuIds=n),data:c.value,placeholder:"请选择","allow-clear":!0,search:!0,multiple:!0,checkStrictly:!1},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}});export{K as _};
