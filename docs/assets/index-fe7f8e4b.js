import{r as P}from"./index-50c19f92.js";import{j as Q,d as q,r as u,au as X,k as N,z as R,av as Y,aw as H,a as _,l as j,f as F,n as J,m as W,t as b,b as i,B as ee,q as L,x as G,C as A,c as B,w as n,Z as f,E as te,D as ae,X as K,G as le,K as oe,o as se,O as ne,P as ie,Q as O,R as E,e as U,A as re,Y as ue}from"./index-ca6d4815.js";import{x as ce}from"./index-9844acf0.js";import{_ as de}from"./index-3f3e39f8.js";import{V as me}from"./index-9cf45c9e.js";import{b as pe,G as fe,c as ye,d as ge}from"./Blogs-9205330e.js";import{u as ve}from"./useConfirm-31f08ffb.js";const he={class:"layui-textarea-wrapper"},_e=["rows","cols","value","placeholder","name","disabled","maxlength"],xe={key:0,class:"layui-textarea-clear"},be={key:1,class:"layui-texterea-count"},we=Q(q({name:"LayTextarea",props:{modelValue:null,name:null,placeholder:null,disabled:{type:Boolean},showCount:{type:Boolean},allowClear:{type:Boolean},cols:null,rows:null,maxlength:null,autosize:{type:[Boolean,Object]}},emits:["blur","input","update:modelValue","change","focus","clear"],setup(c,{expose:V,emit:d}){const s=c,m=u(null),v=u(!1),T=X(),o=u("auto"),k=N(()=>({width:s.cols?"":"100%",height:s.rows?"":o.value,minHeight:s.rows?"":"100px"})),x=N(()=>Object.assign(k.value,T.style)),w=function(e){const r=e.target;v.value||(d("update:modelValue",r.value),H(()=>{d("input",r.value)}))},D=function(e){d("focus",e)},C=function(e){d("blur",e)},h=e=>{const r=e.target;d("change",r.value)},I=function(){d("update:modelValue",""),d("clear")},S=()=>{v.value=!0},a=e=>{v.value=!1,w(e)},l=N(()=>{var e;return((e=s.modelValue)==null?void 0:e.length)>0}),t=N(()=>{var e,r;let y=String((r=(e=s.modelValue)==null?void 0:e.length)!=null?r:0);return s.maxlength&&(y+="/"+s.maxlength),y});return R([()=>s.modelValue,m],()=>{var e;if(!m.value||!s.autosize)return;const r=((e=m.value)==null?void 0:e.scrollHeight)+2;if(Y(s.autosize)){const{minHeight:y,maxHeight:$}=s.autosize;if(r<y||r>$)return}o.value="1px",H(()=>{var y;o.value=`${((y=m.value)==null?void 0:y.scrollHeight)+2}px`})},{immediate:!0}),V({focus:()=>{H(()=>{var e;(e=m.value)==null||e.focus()})},blur:()=>{H(()=>{var e;(e=m.value)==null||e.blur()})}}),(e,r)=>(_(),j("div",he,[F("textarea",{ref_key:"textareaRef",ref:m,class:J(["layui-textarea",{"layui-textarea-disabled":c.disabled}]),rows:c.rows,cols:c.cols,value:c.modelValue,placeholder:c.placeholder,name:c.name,disabled:c.disabled,maxlength:c.maxlength,style:W(b(x)),onCompositionstart:S,onCompositionend:a,onInput:w,onFocus:D,onChange:h,onBlur:C},null,46,_e),c.allowClear&&b(l)?(_(),j("span",xe,[i(b(ee),{type:"layui-icon-close-fill",onClick:I})])):L("",!0),c.showCount?(_(),j("div",be,G(b(t)),1)):L("",!0)]))}})),De=[{key:"categoryId",title:"分类Id",width:"80px",fixed:"left",sort:"desc"},{key:"categoryName",title:"分类名称",width:"150px"},{key:"categoryDescription",title:"分类描述",align:"center",width:"400px"},{key:"isDisable",title:"是否禁用",align:"center",width:"100px",customSlot:"isDisable"},{key:"createTime",title:"创建时间",align:"center",width:"190px",customSlot:"createTime"},{key:"userName",title:"创建人",align:"center",width:"100px"},{key:"operator",title:"操作",align:"left",customSlot:"operator",fixed:"right",width:"200px"}];const Ve=q({__name:"CategoryEditDialog",props:{visible:{type:Boolean},data:{}},emits:["done","update:visible"],setup(c,{emit:V}){const d=c,s=N({get(){return d.visible},set(a){V("update:visible",a)}}),m=u(),v=u(!1),T={categoryId:0,categoryName:"",categoryDescription:"",parentId:0,isDisable:!1},o=A({...T}),k=u({categoryName:{type:"string",required:!0,message:"角色名不能为空"},categoryDescription:{type:"string",required:!0,message:"角色编码不能为空"}}),x=u([]);function w(a){const l={id:a.categoryId,title:a.categoryName,field:a.parentId,children:void 0};if(a.childrenCategorys&&a.childrenCategorys.length>0){const t=a.childrenCategorys.map(e=>w(e));l.children=t}return l}async function D(){try{const a=await fe();if(a){if(!a.isSuccess||!a.responseData){f.msg(`获取分类列表失败:${a.message}`,{icon:2});return}}else{f.msg("获取分类列表失败",{icon:2});return}x.value=[{id:0,title:"父级",field:"",children:[]}],a.responseData.map(l=>{x.value[0].children.push(w(l))})}catch(a){f.msg(a.message,{icon:2})}}function C(){D(),d.data?(Object.assign(o,d.data),v.value=!0):(Object.assign(o,T),v.value=!1)}function h(){var a;m.value.reset(),(a=m.value)==null||a.clearValidate(),s.value=!1}async function I(a,l){try{const t=await pe(a);if(!t||!t.isSuccess){f.msg((t==null?void 0:t.message)||"操作失败",{icon:2});return}f.msg((t==null?void 0:t.message)||"操作成功",{icon:1}),f.close(l),h()}catch(t){f.close(l),f.msg(t.message,{icon:2})}}function S(){m.value.validate((a,l,t)=>{a&&f.msg("正在提交数据...",{icon:16,time:0,shade:!0,success:async e=>{await I(l,e)}})})}return R(()=>d.visible,a=>{a&&C()}),(a,l)=>{const t=me,e=te,r=ae,y=we,$=K,M=le,z=oe;return _(),B(z,{modelValue:s.value,"onUpdate:modelValue":l[5]||(l[5]=p=>s.value=p),area:"500px",title:v.value?"编辑":"新增","shade-close":!1,move:!0,maxmin:!0,btn:[{text:"提交",callback:()=>S()},{text:"关闭",callback:()=>h()}],onClose:h},{default:n(()=>[i(M,{ref_key:"refForm",ref:m,model:o,rules:k.value,style:{padding:"10px"}},{default:n(()=>[i(e,{label:"上级菜单",prop:"parentId",required:""},{default:n(()=>[i(t,{modelValue:o.parentId,"onUpdate:modelValue":l[0]||(l[0]=p=>o.parentId=p),"allow-clear":!0,search:!0,data:x.value,style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),i(e,{label:"名称",prop:"code"},{default:n(()=>[i(r,{modelValue:o.categoryName,"onUpdate:modelValue":l[1]||(l[1]=p=>o.categoryName=p),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),i(e,{label:"描述",prop:"describe"},{default:n(()=>[i(y,{modelValue:o.categoryDescription,"onUpdate:modelValue":l[2]||(l[2]=p=>o.categoryDescription=p),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),i(e,{label:"描述",prop:"describe"},{default:n(()=>[i(y,{modelValue:o.categoryDescription,"onUpdate:modelValue":l[3]||(l[3]=p=>o.categoryDescription=p),placeholder:"请填写","allow-clear":""},null,8,["modelValue"])]),_:1}),i(e,{label:"是否禁用",prop:"switch",mode:"inline"},{default:n(()=>[i($,{modelValue:o.isDisable,"onUpdate:modelValue":l[4]||(l[4]=p=>o.isDisable=p),"onswitch-text":"是","unswitch-text":"否"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","btn"])}}}),ze=q({__name:"index",setup(c){var a;const V=u(window.innerHeight-300);se(()=>{window.addEventListener("resize",d)});function d(){V.value=window.innerHeight-300}const s=u(!1),{loading:m,setLoading:v}=ne(!0),o=((a=ie().meta)==null?void 0:a.title)||"";u();const k=u([]),x=u([]),w=u(["filter"]);A({current:1,limit:10,total:0,showRefresh:!0});const D=u(!1),C=u();v(!1);async function h(l){v(!0);try{let t={categoryName:"",timeState:new Date,timeEnd:new Date};t.timeState.setDate(t.timeState.getDate()-1),t.timeEnd.setDate(t.timeEnd.getDate());const e=await ye(t);if(!e||!e.isSuccess)return;k.value=e.responseData}catch{}finally{v(!1)}}function I(l){if(!l){f.msg("请选择用户",{icon:2,time:2e3});return}ve("确定要删除这条数据吗？",async()=>{debugger;try{const t=await ge(l);if(!t||!t.isSuccess){f.confirm(t.message||"操作失败",{icon:2});return}f.msg(t.message||"操作成功",{icon:1}),h()}catch(t){f.msg(t.message,{icon:2})}finally{}})}function S(l){C.value=l,D.value=!0}return(l,t)=>{const e=re,r=K,y=de,$=ce,M=P,z=O("any-permission"),p=O("permission");return _(),B(M,{fluid:"true",class:"z-container"},{default:n(()=>[i($,{title:b(o)},{default:n(()=>[i(y,{id:"categoryId","selected-keys":x.value,"onUpdate:selectedKeys":t[2]||(t[2]=g=>x.value=g),"children-column-name":"childrenCategorys",height:`${V.value}px`,"default-expand-all":s.value,loading:b(m),columns:b(De),"data-source":k.value,"default-toolbar":w.value,"expand-index":1},{toolbar:n(()=>[E((_(),B(e,{size:"sm",type:"normal",onClick:t[0]||(t[0]=g=>h())},{default:n(()=>[U(" 查询 ")]),_:1})),[[z,["sys:user:add","sys:user:save"]]]),E((_(),B(e,{size:"sm",type:"primary",onClick:t[1]||(t[1]=g=>S())},{default:n(()=>[U(" 新增 ")]),_:1})),[[z,["sys:user:add","sys:user:save"]]])]),operator:n(({row:g})=>[E((_(),B(e,{size:"xs",type:"primary",onClick:Z=>S(g)},{default:n(()=>[U(" 修改 ")]),_:2},1032,["onClick"])),[[z,["sys:user:edit","sys:user:update"]]]),E((_(),B(e,{size:"xs",type:"danger",onClick:Z=>I(g.articleId)},{default:n(()=>[U(" 删除 ")]),_:2},1032,["onClick"])),[[p,"sys:user:delete"]])]),createTime:n(({row:g})=>[F("span",null,G(b(ue)(g.createTime,"yyyy-M-d H:m:s")),1)]),isDisable:n(({row:g})=>[i(r,{"model-value":g.isDisable,"onswitch-text":"是","onswitch-value":!0,"unswitch-text":"否","unswitch-value":!1},null,8,["model-value"])]),_:1},8,["selected-keys","height","default-expand-all","loading","columns","data-source","default-toolbar"])]),_:1},8,["title"]),i(Ve,{visible:D.value,"onUpdate:visible":t[3]||(t[3]=g=>D.value=g),data:C.value,onDone:h},null,8,["visible","data"])]),_:1})}}});export{ze as default};
